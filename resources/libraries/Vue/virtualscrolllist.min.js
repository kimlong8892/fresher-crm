!function(t,e){var a="VirtualScrollList";"object"==typeof exports&&"object"==typeof module?module.exports=e(a,require("vue")):"function"==typeof define&&define.amd?define(["vue"],e.bind(t,a)):"object"==typeof exports?exports[a]=e(a,require("vue")):t[a]=e(a,t.Vue)}(this,function(t,e){"object"==typeof e&&"function"==typeof e.default&&(e=e.default);return e.component(t,{props:{size:{type:Number,required:!0},remain:{type:Number,required:!0},rtag:{type:String,default:"div"},wtag:{type:String,default:"div"},wclass:{type:String,default:""},start:{type:Number,default:0},offset:{type:Number,default:0},variable:[Function,Boolean],bench:Number,debounce:Number,totop:Function,tobottom:Function,onscroll:Function},created:function(){var t=this.start>=this.remain?this.start:0,e=this.remain+(this.bench||this.remain);this.delta={start:t,end:t+e-1,keeps:e,total:0,offsetAll:0,paddingTop:0,paddingBottom:0,varCache:{},varAverSize:0,varLastCalcIndex:0}},watch:{size:function(){this.alter="size"},remain:function(){this.alter="remain"},bench:function(){this.alter="bench"},start:function(){this.alter="start"},offset:function(){this.alter="offset"}},methods:{onScroll:function(t){var a=this.delta,s=this.$refs.vsl,i=s&&(s instanceof e?s.$el:s).scrollTop||0;a.total>a.keeps?this.updateZone(i):a.end=a.total-1;var r=a.offsetAll;this.onscroll&&this.onscroll(t,{offset:i,offsetAll:r,start:a.start,end:a.end}),!i&&a.total&&this.triggerEvent("totop"),i>=r&&this.triggerEvent("tobottom")},updateZone:function(t){var e=this.variable?this.getVarOvers(t):Math.floor(t/this.size),a=this.delta,s=this.getZone(e),i=this.bench||this.remain;!s.isLast&&e>a.start&&e-a.start<=i||s.start===a.start&&s.end===a.end||(a.end=s.end,a.start=s.start,this.forceRender())},forceRender:function(){var t=this;window.requestAnimationFrame(function(){t.$forceUpdate()})},getVarOvers:function(t){for(var e=0,a=0,s=0,i=this.delta,r=i.total;e<=r;){if(a=e+Math.floor((r-e)/2),s=this.getVarOffset(a),i.varAverSize||(i.varAverSize=Math.floor(s/a)),s===t)return a;s<t?e=a+1:s>t&&(r=a-1)}return e>0?--e:0},getVarOffset:function(t,e){var a=this.delta,s=a.varCache[t];if(!e&&s)return s.offset;for(var i=0,r=0;r<t;r++){var n=this.getVarSize(r,e);a.varCache[r]={size:n,offset:i},i+=n}return a.varLastCalcIndex=Math.max(a.varLastCalcIndex,t-1),a.varLastCalcIndex=Math.min(a.varLastCalcIndex,a.total-1),i},getVarSize:function(t,e){var a=this.delta.varCache[t];if(!e&&a)return a.size;if("function"==typeof this.variable)return this.variable(t)||0;var s=this.$slots.default[t],i=s&&s.data&&s.data.style;if(i&&i.height){var r=i.height.match(/^(.*)px$/);return r&&+r[1]||0}return 0},getVarPaddingTop:function(){return this.getVarOffset(this.delta.start)},getVarPaddingBottom:function(){var t=this.delta,e=t.total-1;return t.total-t.end<=t.keeps||t.varLastCalcIndex===e?this.getVarOffset(e)-this.getVarOffset(t.end):(t.total-t.end)*(t.varAverSize||this.size)},getVarAllHeight:function(){var t=this.delta;return t.total-t.end<=t.keeps||t.varLastCalcIndex===t.total-1?this.getVarOffset(t.total):this.getVarOffset(t.start)+(t.total-t.end)*(t.varAverSize||this.size)},updateVariable:function(t){this.getVarOffset(t,!0)},getZone:function(t){var e,a,s=this.delta;t=parseInt(t,10),t=Math.max(0,t);var i=s.total-s.keeps,r=t<=s.total&&t>=i||t>s.total;return r?(a=s.total-1,e=Math.max(0,i)):a=(e=t)+s.keeps-1,{end:a,start:e,isLast:r}},triggerEvent:function(t){this[t]&&this[t]()},setScrollTop:function(t){var a=this.$refs.vsl;a&&((a instanceof e?a.$el:a).scrollTop=t)},filter:function(){var t,e,a,s=this.delta,i=this.$slots.default;i||(i=[],s.start=0),s.total=i.length;var r=s.total>s.keeps;this.variable?(a=this.getVarAllHeight(),t=r?this.getVarPaddingTop():0,e=r?this.getVarPaddingBottom():0):(a=this.size*s.total,t=this.size*(r?s.start:0),e=this.size*(r?s.total-s.keeps:0)-t),s.paddingTop=t,s.paddingBottom=e,s.offsetAll=a-this.size*this.remain;for(var n=[],o=s.start;o<=Math.ceil(s.end);o++)n.push(i[o]);return n}},mounted:function(){if(this.start){var t=this.getZone(this.start).start;this.setScrollTop(this.variable?this.getVarOffset(t):t*this.size)}else this.offset&&this.setScrollTop(this.offset)},beforeUpdate:function(){var t=this.delta;t.keeps=this.remain+(this.bench||this.remain);var e="start"===this.alter?this.start:t.start,a=this.getZone(e);~["start","size","offset"].indexOf(this.alter)&&this.$nextTick(this.setScrollTop.bind(this,"offset"===this.alter?this.offset:this.variable?this.getVarOffset(a.isLast?t.total:a.start):a.isLast&&t.total-e<=this.remain?t.total*this.size:e*this.size)),(e!==a.start||t.end!==a.end||this.alter)&&(this.alter="",t.end=a.end,t.start=a.start,this.forceRender())},render:function(t){var e,a,s,i,r=this.filter(),n=this.delta,o=this.debounce;return t(this.rtag,{ref:"vsl",style:{display:"block","overflow-y":"auto",height:this.size*this.remain+"px"},on:{"&scroll":o?(e=this.onScroll.bind(this),a=o,function(){var t=this,r=arguments,n=s&&!i;clearTimeout(i),i=setTimeout(function(){i=null,s||e.apply(t,r)},a),n&&e.apply(t,r)}):this.onScroll}},[t(this.wtag,{style:{display:"block","padding-top":n.paddingTop+"px","padding-bottom":n.paddingBottom+"px"},class:this.wclass},r)])}})});